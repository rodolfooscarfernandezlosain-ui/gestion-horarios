async function guardarCategoria(e) {
  e.preventDefault(); // Evita que el formulario recargue la página

  // Obtener datos del formulario
  const nombre = document.getElementById('cat-nombre').value.trim();
  const index = document.getElementById('edit-index').value;

  // URL de tu Google Apps Script (sin espacios al final)
  const url = https://script.google.com/macros/s/AKfycbwz2jwNmk-NTN0Q-wWrEXd5YOfznqmxMzO7O6aMlM13YVbPI6FgOWZz2RcXSBwXOEc6xg/exec

  // Validar que el campo no esté vacío
  if (!nombre) {
    showToast('⚠️ Por favor, ingresa un nombre de categoría', true);
    return;
  }

  // Preparar los datos para enviar
  const payload = {
    sheet: 'categorias',  // Nombre de la pestaña en Google Sheets
     { nombre }           // Datos a guardar
  };

  // Si hay un índice, es una edición
  if (index !== '') {
    payload.action = 'update';
    payload.index = parseInt(index); // Aseguramos que sea número
  } else {
    payload.action = 'add';
  }

  try {
    // Enviar datos a Google Apps Script
    const res = await fetch(url, {
      method: 'POST',
      body: JSON.stringify(payload),
      headers: {
        'Content-Type': 'application/json'
      }
    });

    // Si la respuesta no es exitosa, mostramos el error
    if (!res.ok) {
      const errorText = await res.text();
      throw new Error(`Error ${res.status}: ${errorText}`);
    }

    // Mostrar mensaje de éxito
    showToast('✅ Categoría guardada en Google Sheets');

    // Limpiar formulario
    limpiarFormulario();

    // Recargar la lista desde Google Sheets
    await cargarCategorias();

  } catch (err) {
    // Mostrar error en la interfaz
    console.error('Error al guardar la categoría:', err);
    showToast('❌ Error al guardar: ' + err.message, true);
  }
}

