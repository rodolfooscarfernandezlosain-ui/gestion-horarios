async function guardarCategoria(e) {
  e.preventDefault(); // Evita que el formulario recargue la página

  // Obtener datos del formulario
  const nombre = document.getElementById('cat-nombre').value.trim();
  const index = document.getElementById('edit-index').value;

  // ✅ URL corregida: sin espacios
  const API_URL = 'https://script.google.com/macros/s/AKfycbzxK8Xvy7rFeTlkLy06ktxGIhkeQCEyRf-YVvIoBS2LWhZ9f7Lf5yxIGd-s9H241zrteQ/exec';

  // Validar que el campo no esté vacío
  if (!nombre) {
    showToast('⚠️ Por favor, ingresa un nombre de categoría', true);
    return;
  }

  // ✅ payload corregido
  const payload = {
    sheet: 'categorias',
    data: { nombre }
  };

  // Si hay un índice, es una edición
  if (index !== '') {
    payload.action = 'update';
    payload.index = parseInt(index);
  } else {
    payload.action = 'add';
  }

  try {
    // ✅ Usa API_URL, no 'url'
    const res = await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify(payload),
      headers: {
        'Content-Type': 'application/json'
      }
    });

    // Si la respuesta no es exitosa, mostramos el error
    if (!res.ok) {
      const errorText = await res.text();
      throw new Error(`Error ${res.status}: ${errorText}`);
    }

    // Mostrar mensaje de éxito
    showToast('✅ Categoría guardada en Google Sheets');

    // Limpiar formulario
    limpiarFormulario();

    // Recargar la lista desde Google Sheets
    await cargarCategorias();

  } catch (err) {
    // Mostrar error en la interfaz
    console.error('Error al guardar la categoría:', err);
    showToast('❌ Error al guardar: ' + err.message, true);
  }
}
