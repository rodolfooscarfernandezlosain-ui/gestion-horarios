<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Personal</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #f4f6f9; 
            padding: 20px; 
            margin: 0;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            text-align: center;
        }
        h1 { 
            color: #2c3e50; 
            margin-bottom: 10px; 
        }
        p { 
            color: #7f8c8d; 
            margin-bottom: 30px; 
        }
        .menu-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }
        .menu-item { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
            transition: transform 0.2s, box-shadow 0.2s; 
            cursor: pointer; 
            border: 1px solid #e9ecef; 
        }
        .menu-item:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            background: #e9ecef; 
        }
        .menu-item i { 
            font-size: 2.5em; 
            color: #3498db; 
            margin-bottom: 10px; 
        }
        .menu-item h3 { 
            margin: 0 0 10px 0; 
            color: #2c3e50; 
            font-size: 1.2em; 
        }
        .menu-item p { 
            margin: 0; 
            color: #666; 
            font-size: 0.9em; 
        }

        /* ‚úÖ Estilo para mostrar usuario logueado */
        .user-info {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: #666;
            z-index: 999;
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        .user-info.admin { color: #e74c3c; }
        .user-info.encargado { color: #2980b9; }

        /* ‚úÖ Snackbar */
        .snackbar { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: #27ae60; 
            color: white; 
            padding: 12px 20px; 
            border-radius: 6px; 
            z-index: 1000; 
            opacity: 0; 
            transition: opacity 0.3s; 
        }
        .snackbar.show { opacity: 1; }
        .snackbar.error { background: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-users-cog"></i> Sistema de Gesti√≥n de Personal</h1>
        <p>Administraci√≥n de empleados, horarios y recursos humanos</p>

        <div class="menu-grid">
            <a href="gestion_empleados.html" class="menu-item">
                <i class="fas fa-user-plus"></i>
                <h3>Alta de Empleados</h3>
                <p>Registrar, editar y eliminar empleados</p>
            </a>
            <a href="horarios_empleados.html" class="menu-item">
                <i class="fas fa-clock"></i>
                <h3>Horarios de Empleados</h3>
                <p>Asignar horarios semanales por empleado</p>
            </a>
            <a href="horarios_locales.html" class="menu-item">
                <i class="fas fa-store"></i>
                <h3>Horarios por Local</h3>
                <p>Configurar apertura, cierre y personal</p>
            </a>
            <a href="feriados.html" class="menu-item">
                <i class="fas fa-calendar-alt"></i>
                <h3>Feriados</h3>
                <p>Registrar d√≠as feriados por local</p>
            </a>
            <a href="ausencias.html" class="menu-item">
                <i class="fas fa-bed"></i>
                <h3>Ausencias</h3>
                <p>Vacaciones, licencias y enfermedades</p>
            </a>
            <a href="novedades.html" class="menu-item">
                <i class="fas fa-bell"></i>
                <h3>Novedades</h3>
                <p>Resumen mensual de asistencias y ausencias</p>
            </a>
            <a href="personal_optimo.html" class="menu-item">
                <i class="fas fa-balance-scale"></i>
                <h3>Personal √ìptimo</h3>
                <p>Comparar necesidad vs. asignaci√≥n</p>
            </a>
            <a href="grilla_horarios.html" class="menu-item">
                <i class="fas fa-th-large"></i>
                <h3>Grilla de Horarios</h3>
                <p>Vista semanal de todos los horarios</p>
            </a>
            <a href="gestion_usuarios.html" class="menu-item">
                <i class="fas fa-users-cog"></i>
                <h3>Gesti√≥n de Usuarios</h3>
                <p>Administrar accesos y permisos</p>
            </a>
        </div>
    </div>

    <!-- ‚úÖ Mostrar usuario logueado -->
    <div id="user-info" class="user-info">Cargando...</div>

    <!-- ‚úÖ Snackbar -->
    <div id="snackbar" class="snackbar">Acci√≥n realizada</div>

    <!-- ‚úÖ LOGIN B√ÅSICO CON VERIFICACI√ìN EN FIREBASE -->
    <script>
        // ‚úÖ URL de usuarios en Firebase
        const DB_USUARIOS = 'https://gestion-personal-c9edd-default-rtdb.firebaseio.com/usuarios.json';

        // ‚úÖ Verificar login al cargar
        async function verificarLogin() {
            // Si ya est√° logueado, cargar info
            const usuario = sessionStorage.getItem('usuario');
            if (usuario) {
                mostrarUsuario(JSON.parse(usuario));
                return JSON.parse(usuario);
            }

            // Pedir credenciales
            const inputUsuario = prompt('üîê Usuario:');
            if (!inputUsuario) return verificarLogin();

            const inputClave = prompt('üîê Contrase√±a:');
            if (!inputClave) return verificarLogin();

            try {
                const res = await fetch(DB_USUARIOS);
                
                // ‚úÖ Verificar si la respuesta es v√°lida
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();
                
                // ‚úÖ Verificar que haya datos
                if (!data) {
                    alert('‚ùå Error: No se encontraron usuarios en la base de datos');
                    location.reload();
                    return;
                }

                // ‚úÖ Buscar usuario y clave
                const usuariosArray = Object.values(data);
                const user = usuariosArray.find(u => 
                    u.usuario === inputUsuario && u.clave === inputClave
                );

                if (user) {
                    sessionStorage.setItem('usuario', JSON.stringify(user));
                    mostrarUsuario(user);
                    return user;
                } else {
                    alert('‚ùå Usuario o clave incorrectos');
                    location.reload();
                    return null;
                }
            } catch (error) {
                console.error('Error de conexi√≥n:', error);
                alert('‚ùå Error al conectar con la base de datos. Revisa tu conexi√≥n o contacta al administrador.');
                throw error;
            }
        }

        // ‚úÖ Mostrar usuario en pantalla
        function mostrarUsuario(user) {
            const infoDiv = document.getElementById('user-info');
            infoDiv.textContent = `üü¢ ${user.nombre} (${user.rol})`;
            infoDiv.className = `user-info ${user.rol}`;
        }

        // ‚úÖ Ocultar m√≥dulos seg√∫n rol
        function aplicarPermisos(usuario) {
            const gestionUsuariosLink = Array.from(document.querySelectorAll('a')).find(a => 
                a.href.includes('gestion_usuarios.html')
            );
            
            if (gestionUsuariosLink && usuario.rol !== 'admin') {
                gestionUsuariosLink.parentElement.style.display = 'none';
            }
        }

        // ‚úÖ Ejecutar al cargar
        window.onload = async function() {
            try {
                const usuario = await verificarLogin();
                if (usuario) {
                    aplicarPermisos(usuario);
                }
            } catch (error) {
                console.error('Error en login:', error);
            }
        };
    </script>
</body>
</html>
