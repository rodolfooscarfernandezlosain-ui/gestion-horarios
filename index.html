<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Personal</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #f4f6f9; 
            padding: 20px; 
            margin: 0;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            text-align: center;
        }
        h1 { 
            color: #2c3e50; 
            margin-bottom: 10px; 
        }
        p { 
            color: #7f8c8d; 
            margin-bottom: 30px; 
        }
        .menu-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }
        .menu-item { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
            transition: transform 0.2s, box-shadow 0.2s; 
            cursor: pointer; 
            border: 1px solid #e9ecef; 
        }
        .menu-item:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            background: #e9ecef; 
        }
        .menu-item i { 
            font-size: 2.5em; 
            color: #3498db; 
            margin-bottom: 10px; 
        }
        .menu-item h3 { 
            margin: 0 0 10px 0; 
            color: #2c3e50; 
            font-size: 1.2em; 
        }
        .menu-item p { 
            margin: 0; 
            color: #666; 
            font-size: 0.9em; 
        }

        /* ‚úÖ Mostrar usuario logueado */
        .user-info {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: #666;
            z-: 999;
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        .user-info.admin { color: #e74c3c; }
        .user-info.encargado { color: #2980b9; }

        /* ‚úÖ Snackbar */
        .snackbar { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: #27ae60; 
            color: white; 
            padding: 12px 20px; 
            border-radius: 6px; 
            z-: 1000; 
            opacity: 0; 
            transition: opacity 0.3s; 
        }
        .snackbar.show { opacity: 1; }
        .snackbar.error { background: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-users-cog"></i> Sistema de Gesti√≥n de Personal</h1>
        <p>Administraci√≥n de empleados, horarios y recursos humanos</p>

        <div class="menu-grid" id="menu-container">
            <!-- M√≥dulos ser√°n cargados aqu√≠ din√°micamente -->
        </div>
    </div>

    <!-- ‚úÖ Mostrar usuario logueado -->
    <div id="user-info" class="user-info">Cargando...</div>

    <!-- ‚úÖ Snackbar -->
    <div id="snackbar" class="snackbar">Acci√≥n realizada</div>

    <!-- ‚úÖ LOGIN B√ÅSICO -->
    <script>
        const DB_USUARIOS = 'https://gestion-personal-c9edd-default-rtdb.firebaseio.com/usuarios.json';

        // Verificar acceso
        async function verificarLogin() {
            // Si ya est√° logueado, cargar info
            const usuario = sessionStorage.getItem('usuario');
            if (usuario) {
                mostrarUsuario(JSON.parse(usuario));
                return JSON.parse(usuario);
            }

            // Pedir credenciales
            const inputUsuario = prompt('üîê Usuario:');
            if (!inputUsuario) return verificarLogin();

            const inputClave = prompt('üîê Contrase√±a:');
            if (!inputClave) return verificarLogin();

            try {
                const res = await fetch(DB_USUARIOS);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();
                if (!data) {
                    alert('‚ùå Error: No se encontraron usuarios en la base de datos');
                    location.reload();
                    return;
                }

                const usuariosArray = Object.values(data);
                const user = usuariosArray.find(u => 
                    u.usuario === inputUsuario && u.clave === inputClave
                );

                if (user) {
                    sessionStorage.setItem('usuario', JSON.stringify(user));
                    mostrarUsuario(user);
                    return user;
                } else {
                    alert('‚ùå Usuario o clave incorrectos');
                    location.reload();
                    return null;
                }
            } catch (error) {
                console.error('Error de conexi√≥n:', error);
                alert('‚ùå Error al conectar con la base de datos. Revisa tu conexi√≥n o contacta al administrador.');
                throw error;
            }
        }

        // ‚úÖ Mostrar usuario en pantalla
        function mostrarUsuario(user) {
            const infoDiv = document.getElementById('user-info');
            infoDiv.textContent = `üü¢ ${user.nombre} (${user.rol})`;
            infoDiv.className = `user-info ${user.rol}`;
        }

        // ‚úÖ Filtrar m√≥dulos por rol
        function aplicarPermisos(usuario) {
            const menuContainer = document.getElementById('menu-container');
            menuContainer.innerHTML = '';

            // Definir m√≥dulos disponibles
            const modulos = [
                { nombre: 'Alta de Empleados', href: 'gestion_empleados.html', rol: 'admin' },
                { nombre: 'Horarios de Empleados', href: 'horarios_empleados.html', rol: 'admin' },
                { nombre: 'Horarios por Local', href: 'horarios_locales.html', rol: 'admin' },
                { nombre: 'Feriados', href: 'feriados.html', rol: 'admin' },
                { nombre: 'Ausencias', href: 'ausencias.html', rol: 'admin' },
                { nombre: 'Novedades', href: 'novedades.html', rol: 'todos' },
                { nombre: 'Personal √ìptimo', href: 'personal_optimo.html', rol: 'admin' },
                { nombre: 'Grilla de Horarios', href: 'grilla_horarios.html', rol: 'todos' },
                { nombre: 'Gesti√≥n de Usuarios', href: 'gestion_usuarios.html', rol: 'admin' }
            ];

            modulos.forEach(modulo => {
                // El admin ve todos los m√≥dulos, el encargado solo los marcados como 'todos'
                if (usuario.rol === 'admin' || modulo.rol === 'todos') {
                    const item = document.createElement('div');
                    item.className = 'menu-item';
                    item.innerHTML = `
                        <i class="fas fa-${getIcono(modulo.nombre)}"></i>
                        <h3>${modulo.nombre}</h3>
                        <p>${getDescripcion(modulo.nombre)}</p>
                    `;
                    item.onclick = () => {
                        // Guardar usuario en sessionStorage para que otros m√≥dulos lo usen
                        sessionStorage.setItem('usuario', JSON.stringify(usuario));
                        window.location.href = modulo.href;
                    };
                    menuContainer.appendChild(item);
                }
            });
        }

        // ‚úÖ Asignar √≠conos
        function getIcono(nombre) {
            const iconos = {
                'Alta de Empleados': 'user-plus',
                'Horarios de Empleados': 'clock',
                'Horarios por Local': 'store',
                'Feriados': 'calendar-alt',
                'Ausencias': 'bed',
                'Novedades': 'bell',
                'Personal √ìptimo': 'balance-scale',
                'Grilla de Horarios': 'th-large',
                'Gesti√≥n de Usuarios': 'users-cog'
            };
            return iconos[nombre] || 'cog';
        }

        // ‚úÖ Descripciones
        function getDescripcion(nombre) {
            const desc = {
                'Alta de Empleados': 'Registrar, editar y eliminar empleados',
                'Horarios de Empleados': 'Asignar horarios semanales por empleado',
                'Horarios por Local': 'Configurar apertura, cierre y personal',
                'Feriados': 'Registrar d√≠as feriados por local',
                'Ausencias': 'Vacaciones, licencias y enfermedades',
                'Novedades': 'Resumen mensual de asistencias y ausencias',
                'Personal √ìptimo': 'Comparar necesidad vs. asignaci√≥n',
                'Grilla de Horarios': 'Vista semanal de todos los horarios',
                'Gesti√≥n de Usuarios': 'Administrar accesos y permisos'
            };
            return desc[nombre] || 'M√≥dulo de gesti√≥n';
        }

        // ‚úÖ Ejecutar al cargar
        window.onload = async function() {
            try {
                const usuario = await verificarLogin();
                if (usuario) {
                    aplicarPermisos(usuario);
                }
            } catch (error) {
                console.error('Error en login:', error);
            }
        };
    </script>

    <!-- ‚úÖ Bot√≥n flotante -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (document.getElementById('btn-menu-flotante')) return;
            const btn = document.createElement('button');
            btn.id = 'btn-menu-flotante';
            btn.textContent = '‚ò∞ Men√∫';
            btn.title = 'Volver al men√∫ principal';
            btn.style.cssText = `
                position: fixed !important;
                top: 20px !important;
                right: 20px !important;
                z-: 99999 !important;
                padding: 12px 16px !important;
                font-size: 14px !important;
                font-weight: bold !important;
                color: white !important;
                background-color: #2980b9 !important;
                border: none !important;
                border-radius: 6px !important;
                box-shadow: 0 3px 8px rgba(0,0,0,0.3) !important;
                cursor: pointer !important;
                opacity: 1 !important;
                display: block !important;
                transition: all 0.2s ease !important;
            `;
            btn.onclick = () => {
                window.location.href = '.html';
            };
            document.body.appendChild(btn);
        });
    </script>
</body>
</html>

